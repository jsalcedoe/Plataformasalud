<div class="content">
    <div class="row">
        <div class=" col-md-12">
            <div class="card">
                <div class=" card-header"><h1 class=" title">  DESCRIPCIÓN QUIRURGICA</h1></div>
                <div class="card-body">

                    <!---------------------------formulario------------------------------------->
                <form [formGroup]="procedimientoForm">
                    <div class=" card-header col-md-12"><h3 class=" title">Datos personales</h3></div>
                    <div class="row">
                      <div class=" col-md-3 pr-md-1">
                            <div class=" form-group">
                              <label> Documento </label>
                              <input
                                class=" form-control"
                                type="text"
                                disabled
                                formControlName="numdocpac"
                              />
                            </div>
                          </div>

                          <div class=" col-md-3 pr-md-1">
                            <div class=" form-group">
                              <label> Evento </label>
                              <input
                                class=" form-control"
                                type="text"
                                disabled
                                formControlName="eventpxqx_fk"
                              />
                            </div>
                          </div>

                          <div class=" col-md-3 pr-md-1">
                            <div class=" form-group">
                              <label> Consecutivo Paciente </label>
                              <input
                                class=" form-control"
                                type="text"
                                disabled
                                formControlName="conseventpac"
                              />
                            </div>
                          </div>

                          <div class=" col-md-3 pr-md-1">
                            <div class=" form-group">
                              <label> Id Paciente </label>
                              <input
                                class=" form-control"
                                type="text"
                                disabled
                                formControlName="idpac"
                              />
                            </div>
                          </div>

                          <div class=" col-md-3 pr-md-1">
                            <div class=" form-group">
                              <label> Primer Nombre </label>
                              <input
                                class=" form-control"
                                type="text"
                                disabled
                                formControlName="primernompac"
                              />
                            </div>
                          </div>

                          <div class=" col-md-3 pr-md-1">
                            <div class=" form-group">
                              <label> Segundo Nombre </label>
                              <input
                                class=" form-control"
                                type="text"
                                disabled
                                formControlName="segundonompac"
                              />
                            </div>
                          </div>

                          <div class=" col-md-3 pr-md-1">
                            <div class=" form-group">
                              <label> Primer Apellido </label>
                              <input
                                class=" form-control"
                                type="text"
                                disabled
                                formControlName="primerapepac"
                              />
                            </div>
                          </div>

                          <div class=" col-md-3 pr-md-1">
                            <div class=" form-group">
                              <label> Segundo Apellido </label>
                              <input
                                class=" form-control"
                                type="text"
                                disabled
                                formControlName="segundoapepac"
                              />
                            </div>
                        </div>
                    </div>
                    <div class=" card-header col-md-12"><h3 class=" title">Descripción del procedimiento</h3></div>
                    <div class="row">

                        <div class=" col-md-3 pr-md-1">
                            <div class=" form-group">
                              <label> Fecha de procedimiento </label>
                              <input
                                class=" form-control"
                                type="date"
                                formControlName="fechaprocqx"
                              />
                            </div>
                          </div>

                          <div class=" col-md-3 pr-md-1">
                            <div class=" form-group">
                              <label> Hora inicio del procedimiento </label>
                              <input
                                class=" form-control"
                                placeholder="Hora inicio"
                                type="time"
                                formControlName="horainicioprocqx"
                                (keyup)="calculaTQx()"
                              />
                            </div>
                          </div>
                          <div class=" col-md-3 pr-md-1">
                            <div class=" form-group">
                              <label> Hora fin del procedimiento </label>
                              <input
                                class=" form-control"
                                placeholder="Hora final"
                                type="time"
                                formControlName="horafinprocqx"
                                (keyup)="calculaTQx()"
                              />
                            </div>
                          </div>

                          <div class=" col-md-3 pr-md-1">
                            <div class=" form-group">
                              <label> Tiempo quirurgico </label>
                              <input
                                class=" form-control"
                                placeholder="Tiempo quirurgico"
                                disabled = "true"
                                type="text"
                                value="{{tiempoqx}}"
                              />
                            </div>
                          </div>
                          <div class=" col-md-10 pr-md-1">
                            <div><label>Descripción del procedimiento</label></div>
                            <div class=" form-group">
                               <textarea rows="5" cols="80" class="form-control" formControlName="descqx"></textarea>
                            </div>
                          </div>
                          <div class="col-md-4 pr-md-1">
                            <div class="form-group" >
                            <div><label>Material o protesis</label></div>
                            <div class=" form-group">
                                <textarea rows="5" cols="80" class="form-control" formControlName="matprot"></textarea>
                             </div>
                          </div>
                          </div>
                          <div class=" col-md-10 pr-md-1">
                            <div><label>Muestra de patologia</label></div>
                            <div class=" form-group">
                               <textarea rows="5" cols="80" class="form-control" formControlName="muespato"></textarea>
                            </div>
                          </div>
                          <div class=" col-md-10 pr-md-1">
                            <div><label>Complicaciones quirurgicas</label></div>
                            <div class=" form-group">
                               <textarea rows="5" cols="80" class="form-control" formControlName="complicqx"></textarea>
                            </div>
                          </div>
                          <div class=" col-md-10 pr-md-1">
                            <div><label>Hallazgos quirurgicos</label></div>
                            <div class=" form-group">
                               <textarea rows="5" cols="80" class="form-control" formControlName="hallaqx"></textarea>
                            </div>
                          </div>
                          <div class="col-md-3 pr-md-1">
                            <div class="form-group">
                            <div><label>Conducta</label></div>
                            <select class="form-group" style="width: auto;" formControlName="conducqx_fk">
                              <option value="" disabled selected>Seleccione la conducta</option>
                              <option *ngFor="let condpac of conductas" [value]="condpac.idcondpac">{{condpac.detcondpac}}</option>
                            </select>
                          </div>
                          </div>
                          <div class="col-md-4 pr-md-1">
                            <div class="form-group">
                            <div><label>Tipo de anestesia</label></div>
                            <select class="form-group" style="width: auto;" formControlName="anestesia_fk">
                              <option value="" disabled selected>Seleccione el tipo de anestesia</option>
                              <option *ngFor="let tanes of tipoanest" [value]="tanes.idtipanest">{{tanes.desctipanest}}</option>
                            </select>
                          </div>
                          </div>

                    </div>
                    <div class=" card-header col-md-12"><h3 class=" title">Procedimientos Realizados</h3></div>
                    
                        <!-- Sección de Procedimientos -->
                      <div class="row">
                        <div class="col-md-12">
                        <div formArrayName="procedimientos">
                          <div *ngFor="let proc of procqxArray.controls; let i = index" [formGroupName]="i" class="row align-items-center">
                            <div class="col-md-8 pr-md-1">
                              <div class="form-group">
                                <label>Procedimiento</label>
                                <input 
                                  class="form-control" 
                                  type="text" 
                                  formControlName="nombreProcedimiento" 
                                  (input)="filterProcedimientos($event, i)" 
                                  placeholder="Escriba para buscar procedimiento" 
                                />
                                <ul class="list-group" *ngIf="filteredProcedimientos[i]?.length">
                                  <li 
                                    class="list-group" 
                                    *ngFor="let item of filteredProcedimientos[i]" 
                                    (click)="selectProcedimiento(item, i)">
                                    {{ item.nompxex }}
                                  </li>
                                </ul>
                              </div>
                            </div>
                            <div class="col-md-2">
                              <button type="button" class="btn btn-danger" (click)="removeProcedimiento(i)">Eliminar</button>
                            </div>
                          </div>
                          <button type="button" class="btn btn-primary" (click)="addProcedimiento()">Agregar Procedimiento</button>
                        </div>
                      </div>  
                    </div>
                    <div class=" card-header col-md-12"><h3 class=" title">Equipo Quirurgico</h3></div>
                    
                        <!-- Sección de Equipo Qx -->
                        <div class="row">
                          <div class="col-md-12">   
                        <div formArrayName="equipoQx">
                          <div *ngFor="let equipoQx of userArray.controls; let i = index" [formGroupName]="i" class="row align-items-center">
                            <div class="col-md-8 pr-md-1">
                              <div class="form-group">
                                <label>Integrante Equipo Quirurgico</label>
                                <input 
                                  class="form-control" 
                                  type="text" 
                                  formControlName="firstname"
                                  (input)="filterUsuarios($event, i)" 
                                  placeholder="Escriba para buscar el usuario" 
                                />
                                <ul class="list-group" *ngIf="filterUser[i]?.length">
                                  <li 
                                    class="list-group" 
                                    *ngFor="let item of filterUser[i]" 
                                    (click)="selectUsuarios(item, i)">
                                    {{ item.firstname }} {{item.lastname}} - {{item.carguser_fk.detcarguser}}
                                  </li>
                                </ul>
                              </div>
                            </div>
                            
                            <div class="col-md-2">
                              <button type="button" class="btn btn-danger" (click)="removeUser(i)">Eliminar</button>
                            </div>
                          </div>
                          <button type="button" class="btn btn-primary" (click)="addUser()">Agregar Usuarios</button>
                        </div>
                    </div>
                    <app-creadiagnosticosatencion #diagnosticosComp></app-creadiagnosticosatencion>
                    <div class="card-footer">
                      <button class="btn btn-fill btn-danger" type="submit" (click)="guardarTodo()">Guardar</button>
                    </div>
                  </div> 
                </form>
                    <!-------------------------------------------------------------------------->
                    

                </div>
            </div>
        </div>
    </div>
</div>
